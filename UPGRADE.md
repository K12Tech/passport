# Upgrade Guide

## Upgrading To 9.0 From 8.0

### Support For Multiple Guards

PR: https://github.com/laravel/passport/pull/1220

Passport now has support for multiple guard providers. This requires that you add a new `provider` column on the `oauth_clients`. Add and run the following migration in your app:

    Schema::table('oauth_clients', function (Blueprint $table) {
        $table->string('provider')->nullable();
    });

### Client Credentials Secret Hashing

PR: https://github.com/laravel/passport/pull/1145

If you want to make use of the new secret hashing functionality there's a couple of things you should be aware of. First of all, there's no way back once you've migrated your existing tokens. Once your secrets are hashed, they can't be reversed back to their old values. Secondly, with the new hashing secret you'll get one chance only to display the value to the user before it's gone.

Converting existing applications can be done by adding `Passport::hashClientSecrets();` to the `boot` method of your `AppServiceProvider` class. We've also included a new command which you can run to hash all existing client secrets.

    php artisan passport:hash

**Please be aware that running this command cannot be undone.**

### Client Credentials Middleware Changes

PR: https://github.com/laravel/passport/pull/1132

[After lengthy debate](https://github.com/laravel/passport/issues/1125) it was decided to revert the change made [in the original PR](https://github.com/laravel/passport/pull/1040) that introduced exception throwing when the client credentials middleware was used for first party clients.

### Switch from `getKey` to `getAuthIdentifier`

PR: https://github.com/laravel/passport/pull/1134

Internally, Passport will now use the `getAuthIdentifier` method to determine a model's primary key. This is more in line with the framework and other usages in first party libraries.

### Remove Deprecated Functionality

PR: https://github.com/laravel/passport/pull/1235

The `revokeOtherTokens` and `pruneRevokedTokens` methods as well as the `revokeOtherTokens` and `pruneRevokedTokens` properties on the `Passport` object were removed.


## Upgrading To 8.0 From 7.0

### Minimum & Upgraded Versions

Commit: https://github.com/laravel/passport/commit/97e3026790d953d7a67fe487e30775cd995e93df

The minimum Laravel version is now v6.0 and the minimum PHP version is now 7.2. The underlying `league/oauth2-server` has also been updated to v8.

### Public Clients

PR: https://github.com/laravel/passport/pull/1065

Passport now supports public clients and PCKE. To leverage this feature, you should update the the `secret` column of the `oauth_clients` table to be `nullable`:

    Schema::table('oauth_clients', function (Blueprint $table) {
        $table->string('secret', 100)->nullable()->change();
    });

### Renderable Exceptions For OAuth Errors

PR: https://github.com/laravel/passport/pull/1066

OAuth exceptions can now be rendered. They will first be converted to Passport exceptions. If you are explicitly handling `League\OAuth2\Server\Exception\OAuthServerException` in your exception handler's report method you will now need to check for an instance of `Laravel\Passport\Exceptions\OAuthServerException` instead.

### Fixed Credential Checking

PR: https://github.com/laravel/passport/pull/1040

In the previous versions of Passport, you could pass tokens granted by a different client type to the `CheckClientCredential` and `CheckClientCredentialForAnyScope` middleware. This behavior has been corrected and an exception will be thrown if you attempt to pass a token generated by a different client type.
